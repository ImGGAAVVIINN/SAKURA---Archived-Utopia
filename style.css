@import url('https://unpkg.com/normalize.css') layer(normalize);

@font-face {
  font-family: 'Frutiger';
  src: url('fonts/frutiger/Frutiger.ttf') format('truetype');
}

@layer normalize, base, demo, toggle, transitions, debug;

@layer debug {
  .arrow {
    font-family: 'Gloria Hallelujah', cursive;
    font-size: .875rem;
    position: absolute;
    opacity: .6;

    span {
      white-space: nowrap;
      display: inline-block;
    }

    &.arrow--main {
      right: 120%;
      rotate: -30deg;
      transition: opacity .26s ease-out;
      svg {
        rotate: 10deg;
        width: 24px;
        top: 150%;
        left: 50%;
        position: absolute;
        scale: -1 1;
      }
      /* use Frutiger for the main "tap and drag" callout */
    }
  }
  [data-debug=true] {
    main {
      transform: rotateX(-24deg) rotateY(24deg);
      transition: transform 0.32s ease-out;
    }
    :is(.debug, .knockout--debug) {
      opacity: 1;
      transition-property: transform, opacity;
      transition-duration: 0.32s, 0.32s;
      transition-delay: 0.4s, 0.4s;
      transition-timing-function: ease-out, ease-in;
    }
    .debug--knockout {
      transform: translate3d(0, 0, -200px);
    }
    .debug--indicator {
      transform: translate3d(0, 0, 200px);
    }
    .debug .arrow {
      opacity: .6;
      transition: opacity 0.1s 0.8s ease-out;
    }
  }
  .debug {
    transform-style: preserve-3d;
    outline: 4px var(--checked) dashed;
    outline-offset: 4px;
    height: 100%;
    width: 100%;
    opacity: 0;
    border-radius: inherit;
    pointer-events: none;
    position: absolute;
    inset: 0;
    
    .arrow {
      transform-style: preserve-3d;
      position: absolute;
      left: calc(100% + 2rem);
      top: 50%;
      translate: 0 -50%;
      transform: rotateY(-24deg) rotateX(24deg) translate3d(0, 0, 100px);
      z-index: 20;
      opacity: 0;
    }
  }
  .indicator__liquid--debug {
    pointer-events: none;
    
    .wrapper {
      clip-path: unset;
    }
    .liquids {
      overflow: visible;
    }
  }

  :is(.debug) {
    transition-property: transform, opacity;
    transition-duration: 0.32s, 0.32s;
    transition-delay: 0.2s, 0.2s;
    transition-timing-function: ease-in, ease-out;
  }
  
  main {
    position: relative;
    transition: transform 0.32s 0.4s ease-out;
  }

  main,
  .liquid-toggle {
    transform-style: preserve-3d;
  }
}

@layer transitions {
  :root {
    --transition: 0.2s;
    --ease: ease-out;
  }
  [data-pressed=true] .liquid__track {
    min-height: 15px;
  }
  [data-bounce='true']:has(:is(button:active, [data-pressed="true"])) {
    --transition: 0.6s;
    --ease: linear(
      0 0%,
      0.6091 3.69%,
      1.0259 7.24%,
      1.1733 9.05%,
      1.283 10.92%,
      1.3562 12.87%,
      1.3948 14.95%,
      1.4014 16.03%,
      1.3999 17.16%,
      1.3731 19.64%,
      1.3202 22.27%,
      1.1394 29.39%,
      1.0582 33.17%,
      0.9943 37.45%,
      0.9734 39.64%,
      0.9593 41.92%,
      0.9505 45.08%,
      0.9517 48.7%,
      0.9924 63.02%,
      1.0046 71.2%,
      1.0061 78.24%,
      1 100%
    );
  }
  .indicator--masked .mask {
    translate: calc(
        (var(--complete) / 100) * (100cqi - 60cqi - (0 * var(--border)))
      ) -50%;
    transition-property: height, width, margin, scale;
    transition-duration: var(--transition);
    transition-timing-function: var(--ease);
    will-change: height, width, margin;
  }
  .wrapper {
    clip-path: inset(0 0 0 0 round 100px);
    filter: blur(6px);
    transition: filter var(--transition) var(--ease);
  }
  [aria-pressed='true']:not([data-active='true']) .liquid__track {
    left: calc(var(--border) * 6);
  }
  .liquid__track {
    left: 0;
    transition-property: height, width, filter, left;
    transition-duration: var(--transition);
    transition-timing-function: var(--ease);
    translate: calc(
        (var(--complete) / 100) * (100cqi - 100% - (6 * var(--border)))
      ) -50%;
  }
  [data-mapped=false] .liquid__track {
    transition-property: height, width, filter, left, background;
    transition-duration: var(--transition), var(--transition), var(--transition), var(--transition), calc(var(--transition) * 0.5);
    transition-timing-function: var(--ease), var(--ease), var(--ease), var(--ease), ease-out;
  }
  .indicator__liquid {
    translate: calc(
        (var(--complete) / 100) * (100cqi - 100% - (2 * var(--border)))
      ) -50%;
    transition-property: scale;
    transition-duration: var(--transition);
    transition-timing-function: var(--ease);
  }
  .indicator__liquid :is(.cover, .shadow) {
    transition: opacity var(--transition) var(--ease);
  }
  [data-active='true'] .indicator--masked .mask,
  .liquid-toggle:active .indicator--masked .mask {
    height: calc((100% - (2 * var(--border))) * (1.65 - (var(--delta, 0) * 0.025)));
    width: calc((60% - (2 * var(--border))) * (1.65 + (var(--delta, 0) * 0.025)));
    margin-left: calc((60% - (2 * var(--border))) * ((.65 + (var(--delta, 0) * 0.025)) * -0.5));
  }
  [data-active='true'] .indicator__liquid,
  .liquid-toggle:active .indicator__liquid {
    scale: calc(1.65 + (var(--delta, 0) * 0.025)) calc(1.65 - (var(--delta, 0) * 0.025));
  }

  [data-active='true'] .wrapper,
  .liquid-toggle:active .wrapper {
    filter: blur(0px);
  }

  [data-active='true'] .indicator__liquid .shadow,
  .liquid-toggle:active .indicator__liquid .shadow {
    opacity: 1;
  }

  [data-active='true'] .indicator__liquid .cover,
  .liquid-toggle:active .indicator__liquid .cover {
    opacity: 0;
  }

  [data-active='true'] .indicator__liquid .liquid__track,
  .liquid-toggle:active .indicator__liquid .liquid__track {
    left: calc(var(--border) * 3);
    height: calc((var(--height) * 1px) - (6 * var(--border)));
  }
}

@layer toggle {
  /* Windows 7 Aero CSS Variables */
  :root {
    --w7-surface: #f0f0f0;
    --w7-el-bg: #f2f2f2;
    --w7-el-bg-s-1: #ebebeb;
    --w7-el-bg-s-2: #cfcfcf;
    --w7-el-sd: inset 0 0 0 1px #fffc;
    --w7-el-bd: #8e8f8f;
    --w7-el-bd-h: #3c7fb1;
    --w7-el-bdr: 3px;
    --w7-pg-bg: #00d82c;
  }

  [data-mapped=false] .liquid-toggle {
    --progress: round(down, var(--complete), 85);
    --checked: hsl(
      var(--hue, 144),
      calc((8 + (var(--progress) / 85 * (92))) * 1%),
      calc((81 - (var(--progress) / 85 * (81 - 43))) * 1%)
    );
    .indicator, .indicator--masked {
      transition: background calc(var(--transition) * 0.5) ease-out;
    }
    .liquid__shadow {
      transition: box-shadow calc(var(--transition) * 0.5) ease-out;
    }
  }

  .liquid-toggle {
    --unchecked: hsl(218, 8%, 81%);
    --checked: hsl(
      var(--hue, 144),
      calc((8 + (var(--complete) / 100 * (92))) * 1%),
      calc((81 - (var(--complete) / 100 * (81 - 43))) * 1%)
    );
    --control: hsl(300, 100%, 100%);
    --border: 3px;
    --width: 100;
    --height: 30;
    height: calc(var(--height) * 1px);
    width: calc(var(--width) * 1px);
    border-radius: var(--w7-el-bdr);
    border: 1px solid var(--w7-el-bd);
    padding: 0;
    cursor: pointer;
    position: relative;
    overflow: visible;
    container-type: inline-size;
    background: 
      radial-gradient(circle at 0 50%, #0000001f 5px, transparent 15px),
      radial-gradient(circle at 100% 50%, #0000001f 5px, transparent 15px),
      linear-gradient(180deg, #f3f3f3af, #fcfcfcaf 3px, #dbdbdbaf 6px, #cacacaaf 0, #d5d5d5af),
      #ddd;
    box-shadow: 
      inset 0 0 0 1px #f3f3f388,
      0 0 0 1px #eaeaea88;
    transition: outline var(--transition) var(--ease), border-color var(--transition) var(--ease);
    outline-offset: 2px;
  }

  /* hidden pre-animation state so the control doesn't flash in before pop-in */
  .liquid-toggle.pre-pop {
    opacity: 0;
    transform: translate3d(0, 24px, 0) scale(.6) skewX(0) skewY(0);
    filter: blur(6px);
    pointer-events: none;
  }

  @media (prefers-reduced-motion: reduce) {
    .liquid-toggle.pre-pop {
      opacity: 1;
      transform: none;
      filter: none;
      pointer-events: auto;
    }
  }

  /* Full-screen flash overlay used when switch toggles */
  .white-flash-overlay {
    position: fixed;
    inset: 0;
    background: #fff;
    z-index: 99999;
    pointer-events: none;
    /* start with a tiny circle at the toggle position */
    clip-path: circle(0px at 0px 0px);
    transition: clip-path 520ms cubic-bezier(.22,.9,.33,1), opacity 220ms linear;
    opacity: 1;
  }

  /* When page is flashed keep a clean white bg */
  .is-flashed {
    background: #fff !important;
    color: #000 !important;
  }

  @media (prefers-reduced-motion: reduce) {
    .white-flash-overlay { transition: none; }
  }

  .liquid-toggle:focus-visible {
    outline: 4px solid color-mix(in oklch, var(--checked), #0000);
    border-color: var(--w7-el-bd-h);
  }

  .liquid-toggle:active {
    outline: none;
  }
  .liquid-toggle[data-active='true']:focus-visible {
    outline: 4px solid #0000;
  }

  .indicator {
    border-radius: var(--w7-el-bdr);
    pointer-events: none;
    height: 100%;
    width: 100%;
    background-color: var(--w7-pg-bg);
    background-image: 
      linear-gradient(180deg, #f3f3f3af, #fcfcfcaf 3px, #dbdbdbaf 6px, transparent 0),
      radial-gradient(circle at 0 50%, #0000002f 5px, transparent 15px),
      radial-gradient(circle at 100% 50%, #0000002f 5px, transparent 15px),
      linear-gradient(180deg, transparent 65%, #ffffff55),
      linear-gradient(180deg, transparent 6px, #cacaca33 0, #d5d5d533);
    box-shadow: inset 0 0 0 1px #ffffff1f;
    position: absolute;
    top: 50%;
    scale: 1;
    left: 50%;
    translate: -50% -50%;
    clip-path: inset(0 calc(100% - var(--complete) * 1%) 0 0);
    transition: clip-path var(--transition) var(--ease);
  }

  .knockout {
    height: calc(var(--height) * 1px);
    width: calc(var(--width) * 1px);
    border-radius: var(--w7-el-bdr);
    filter: url(#remove-black);
    position: absolute;
    inset: 0;
    will-change: filter, scale;
    transform: translate3d(0, 0, 0);
  }
  .indicator--masked {
    background-color: var(--w7-pg-bg);
    background-image: 
      linear-gradient(180deg, #f3f3f3af, #fcfcfcaf 2px, #dbdbdbaf 4px, transparent 0),
      radial-gradient(circle at 0 50%, #0000002f 5px, transparent 15px),
      radial-gradient(circle at 100% 50%, #0000002f 5px, transparent 15px),
      linear-gradient(180deg, transparent 65%, #ffffff55),
      linear-gradient(180deg, transparent 4px, #cacaca33 0, #d5d5d533);
    box-shadow: inset 0 0 0 1px #ffffff1f;
    z-index: 12;
    height: 100%;
    width: 100%;
    translate: -50% -50%;
    container-type: inline-size;
    border-radius: var(--w7-el-bdr);
    clip-path: inset(0 calc(100% - var(--complete) * 1%) 0 0);
    transition: clip-path var(--transition) var(--ease);

    .mask {
      position: absolute;
      height: calc(100% - (2 * var(--border)));
      width: calc(60% - (2 * var(--border)));
      top: 50%;
      background: #000;
      left: var(--border);
      border-radius: var(--w7-el-bdr);
    }
  }

  .wrapper {
    position: absolute;
    inset: 0;
    border-radius: var(--w7-el-bdr);
  }

  .liquids {
    position: absolute;
    inset: 0;
    transform: translate3d(0, 0, 0);
    border-radius: var(--w7-el-bdr);
    overflow: hidden;
    filter: url(#goo);

    .liquid__shadow {
      position: absolute;
      inset: 0;
      box-shadow: inset 0px 0px 2px 2px var(--w7-pg-bg),
        inset calc(((var(--complete) / 100) * 4px) + -2px) 0px 2px 2px var(--w7-pg-bg);
      border-radius: var(--w7-el-bdr);
    }

    .liquid__track {
      content: '';
      height: calc((var(--height) * 1px) - (0 * var(--border)));
      width: calc((var(--width) * 1px) - (0 * var(--border)));
      background-color: var(--w7-pg-bg);
      background-image: 
        linear-gradient(180deg, transparent 65%, #ffffff55),
        linear-gradient(180deg, transparent 4px, #cacaca33 0, #d5d5d533);
      border-radius: var(--w7-el-bdr);
      position: absolute;
      top: 50%;
    }
  }

  .indicator__liquid {
    position: absolute;
    height: calc(100% - (2 * var(--border)));
    width: calc(60% - (2 * var(--border)));
    container-type: inline-size;
    top: 50%;
    background: #0000;
    left: var(--border);
    border-radius: var(--w7-el-bdr);

    /* watery jello ripple used on initial pop-in */
    --jello-duration: 900ms;

  /* Pop-in (watery jello) animation for the switch */
  @keyframes jello-pop {
    0% {
      transform: translate3d(0, 24px, 0) scale(.6) skewX(0deg) skewY(0deg);
      opacity: 0;
      filter: blur(6px);
    }
    40% {
      transform: translate3d(0, -8px, 0) scale(1.18) skewX(-3deg) skewY(3deg);
      opacity: 1;
      filter: blur(2px);
    }
    55% {
      transform: translate3d(0, 8px, 0) scale(.92) skewX(3deg) skewY(-3deg);
    }
    70% {
      transform: translate3d(0, -4px, 0) scale(1.06) skewX(-1.5deg) skewY(1.5deg);
    }
    85% {
      transform: translate3d(0, 2px, 0) scale(.99) skewX(.6deg) skewY(-.6deg);
    }
    100% {
      transform: translate3d(0, 0, 0) scale(1) skewX(0) skewY(0);
      opacity: 1;
      filter: none;
    }
  }

  /* small inner ripple to make the liquid wobble */
  @keyframes liquid-ripple {
    0% { transform: scaleX(1) scaleY(1); }
    30% { transform: scaleX(1.08) scaleY(.92); }
    55% { transform: scaleX(.92) scaleY(1.06); }
    80% { transform: scaleX(1.03) scaleY(.97); }
    100% { transform: scaleX(1) scaleY(1); }
  }

  /* class toggled on page load */
  .liquid-toggle.pop-in {
    /* stronger rule to ensure animation applies when toggled from console */
    animation-name: jello-pop !important;
    animation-duration: var(--jello-duration) !important;
    animation-timing-function: cubic-bezier(.22,.9,.33,1) !important;
    animation-fill-mode: both !important;
    transform-origin: 50% 50%;
    /* subtle pop shadow so you can see it triggered even if animation is blocked */
    box-shadow: 0 24px 48px rgba(0,0,0,0.12) inset, 0 12px 30px rgba(0,0,0,0.12);
  }

  .liquid-toggle.pop-in .indicator__liquid .liquid__track,
  .liquid-toggle.pop-in .indicator__liquid .liquid__shadow {
    animation-name: liquid-ripple !important;
    animation-duration: var(--jello-duration) !important;
    animation-timing-function: cubic-bezier(.22,.9,.33,1) !important;
    animation-fill-mode: both !important;
    transform-origin: 50% 50%;
  }

  /* Respect user's reduced motion preference */
  @media (prefers-reduced-motion: reduce) {
    .liquid-toggle.pop-in,
    .liquid-toggle.pop-in .indicator__liquid .liquid__track,
    .liquid-toggle.pop-in .indicator__liquid .liquid__shadow {
      animation: none !important;
      transform: none !important;
    }
  }

    .shadow {
      opacity: 0;
      content: '';
      position: absolute;
      inset: 0;
      border-radius: var(--w7-el-bdr);
      box-shadow: 
        1px -1px 2px hsl(0 0% 100% / 0.5) inset,
        0px -1px 2px hsl(0 0% 100% / 0.5) inset,
        -1px -1px 2px hsl(0 0% 100% / 0.5) inset,
        1px 1px 2px hsl(0 0% 30% / 0.5) inset,
        -4px 2px 5px -3px hsl(0 0% 30% / 0.25) inset,
        -1px 1px 3px hsl(0 0% 30% / 0.25) inset,
        -1px -1px 4px hsl(0 0% 60% / 0.15), 
        1px 1px 2px hsl(0 0% 30% / 0.15),
        2px 2px 3px hsl(0 0% 30% / 0.15),
        -2px -1px 2px hsl(0 0% 100% / 0.25) inset,
        2px 3px 8px -3px hsl(0 0% 30% / 0.5);
      z-index: 20;
    }

    .cover {
      content: '';
      position: absolute;
      inset: 0;
      background: 
        url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAJCAYAAAALpr0TAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAADcSURBVChTNZBLqoUwEEQrURQUxZGCvy24ACfiityJi7tv8GauQoPxk5tquA2RQ9vVVYk6z9NZaxFFEe77htYazjk8z4MwDIVZ+rourOuKaZrwvi+WZcE8z1BKCbPPCjk4DAO2bRP1OI7wLiL6Mbd7J408z1GWpQwWRYGqqiQG+03TgMu0MacfUN4qANmn8UOv9MjW3sKaSm7iIdOSlziOQ3LScd93aPonSYK6riVLlmVo21aYfVqzND9pmqLrOlGT+76XbcxLZkb19/l3fEP+oF0cx8KMEASBsDEGX2/CgZCHkg+8AAAAAElFTkSuQmCC") no-repeat 50%,
        linear-gradient(180deg, var(--w7-el-bg) 45%, var(--w7-el-bg-s-1) 45%, var(--w7-el-bg-s-2));
      background-size: auto, 100% 100%;
      border: 1px solid var(--w7-el-bd);
      border-radius: var(--w7-el-bdr);
      box-shadow: var(--w7-el-sd);
      transition: background var(--transition) var(--ease), border-color var(--transition) var(--ease);
    }

    &:hover .cover {
      background: 
        url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAJCAYAAAALpr0TAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAADcSURBVChTNZBLqoUwEEQrURQUxZGCvy24ACfiityJi7tv8GauQoPxk5tquA2RQ9vVVYk6z9NZaxFFEe77htYazjk8z4MwDIVZ+rourOuKaZrwvi+WZcE8z1BKCbPPCjk4DAO2bRP1OI7wLiL6Mbd7J408z1GWpQwWRYGqqiQG+03TgMu0MacfUN4qANmn8UOv9MjW3sKaSm7iIdOSlziOQ3LScd93aPonSYK6riVLlmVo21aYfVqzND9pmqLrOlGT+76XbcxLZkb19/l3fEP+oF0cx8KMEASBsDEGX2/CgZCHkg+8AAAAAElFTkSuQmCC") no-repeat 50%,
        linear-gradient(180deg, #eaf6fd 45%, #bee6fd 45%, #a7d9f5);
      background-size: auto, 100% 100%;
      border-color: var(--w7-el-bd-h);
    }
  }
}

@layer base {
  :root {
    --font-size-min: 16;
    --font-size-max: 20;
    --font-ratio-min: 1.2;
    --font-ratio-max: 1.33;
    --font-width-min: 375;
    --font-width-max: 1500;
  }

  html {
    color-scheme: light dark;
  }

  [data-theme='light'] {
    color-scheme: light only;
  }

  [data-theme='dark'] {
    color-scheme: dark only;
  }

  :where(.fluid) {
    --fluid-min: calc(
      var(--font-size-min) * pow(var(--font-ratio-min), var(--font-level, 0))
    );
    --fluid-max: calc(
      var(--font-size-max) * pow(var(--font-ratio-max), var(--font-level, 0))
    );
    --fluid-preferred: calc(
      (var(--fluid-max) - var(--fluid-min)) /
        (var(--font-width-max) - var(--font-width-min))
    );
    --fluid-type: clamp(
      (var(--fluid-min) / 16) * 1rem,
      ((var(--fluid-min) / 16) * 1rem) -
        (((var(--fluid-preferred) * var(--font-width-min)) / 16) * 1rem) +
        (var(--fluid-preferred) * var(--variable-unit, 100vi)),
      (var(--fluid-max) / 16) * 1rem
    );
    font-size: var(--fluid-type);
  }

  *,
  *:after,
  *:before {
    box-sizing: border-box;
  }

  body {
    background: light-dark(#fff, #000);
    display: grid;
    place-items: center;
    min-height: 100vh;
    font-family: 'SF Pro Text', 'SF Pro Icons', 'AOS Icons', 'Helvetica Neue',
      Helvetica, Arial, sans-serif, system-ui;
  }

  .intro,
  .sticky-cols,
  .outro {
    font-family: 'Frutiger', sans-serif;
  }

  .bear-link {
    color: canvasText;
    position: fixed;
    top: 1rem;
    left: 1rem;
    width: 48px;
    aspect-ratio: 1;
    display: grid;
    place-items: center;
    opacity: 0.8;
  }

  :where(.x-link, .bear-link):is(:hover, :focus-visible) {
    opacity: 1;
  }

  .bear-link svg {
    width: 75%;
  }

  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }
}


